# @craft-cross-cms/rich-text-core

TipTap-based rich text core for Craft Cross CMS.
This library provides HTML to JSON conversion functionality for rich text content.

## Getting Started

### Installation

```bash
npm install @craft-cross-cms/rich-text-core
```

or

```bash
pnpm add @craft-cross-cms/rich-text-core
```

or

```bash
yarn add @craft-cross-cms/rich-text-core
```

### Usage

```typescript
import { generateJSON, buildTiptapExtensions } from '@craft-cross-cms/rich-text-core';

const html = '<p>Hello <strong>World</strong>!</p>';
const json = generateJSON(html, buildTiptapExtensions({}));

console.log(json);
// Output:
// {
//   type: 'doc',
//   content: [
//     {
//       type: 'paragraph',
//       content: [
//         { type: 'text', text: 'Hello ' },
//         { type: 'text', marks: [{ type: 'bold' }], text: 'World' },
//         { type: 'text', text: '!' }
//       ]
//     }
//   ]
// }
```

### Image Handling

When displaying images in rich text content, you can use the following approach:

#### Setting Image Attributes Directly in HTML

Set `src`, `alt`, `width`, `height`, and `data-asset-id` attributes directly on the `img` tag without using `resolveAsset`.

```typescript
import { buildTiptapExtensions } from '@craft-cross-cms/rich-text-core';
import { generateHTML } from '@tiptap/html';

// Rich text JSON with image data
const richTextJson = {
  type: 'doc',
  content: [
    {
      type: 'cmsImage',
      attrs: {
        id: 'asset123',
        src: 'https://example.com/image.jpg',
        alt: 'Image description',
        width: 800,
        height: 600,
      },
    },
  ],
};

// Build extensions without resolveAsset
const extensions = buildTiptapExtensions({
  resolveAsset: undefined, // or omit this option
});

// Generate HTML
const html = generateHTML(richTextJson, extensions);

// Generated HTML:
// <img src="https://example.com/image.jpg"
//      alt="Image description"
//      width="800"
//      height="600"
//      data-asset-id="asset123">
```

This approach requires including all image information in the rich text JSON.

### Embed Elements

When using embed elements (e.g., embedded videos, external content), users cannot create the JSON content directly. **Embed content must be created manually through the admin interface.**

The embed element requires specific attributes that are generated by the admin interface:

```typescript
{
  type: 'embed',
  attrs: {
    type: 'embed',
    url: 'https://example.com/embed-url',
    embedHtml: '<iframe src="..."></iframe>', // Generated by admin interface
  },
}
```

> **Note:** The `embedHtml` attribute contains the actual embed code and should only be created through the admin interface to ensure proper formatting and security.
